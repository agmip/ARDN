# Dataset Annotation

The first step toward the end goal of making existing datasets interoperable for crop models and other quantitative analyses. We envision applications, protocols, and procedures to help a data provider to document and annotate existing datasets with terms that will allow automated interpretation, translation, and re-use of the data without modifying the dataset or the permanent DOI link. Standardized terms were identified in Activity 2a. These terms include ontologies that enable linkage of data through semantic technologies, as well as annotation with ICASA terms that will allow use of existing AgMIP translation tools for use with crop modeling applications.
As a first step for this Activity, we developed a common set of protocols for annotating CGIAR datasets. We then manually applied these protocols to the datasets identified in Activity 3b to produce the annotations necessary for translation to AgMIP harmonized data format. 
Three sidecar files contain the annotation for each dataset. These files can be included as part of the metadata stored on GARDIAN for those datasets that meet the minimum qualifying criteria described in Activity 3a. All three sidecar files will be stored in JavaScript Object Notation (JSON) files. The intent and content of each file are described below. A more detailed listing with explanation of the sidecar files is presented in Appendix C for one dataset as an example of the content and structure of the files. Sidecar files for all datasets listed in Activity 4b can be found here: github.com/frostbytten/gardian_metadata.
Sidecar file #1 (SC1) provides a map of column data headers to ontology terms from AgrO, UO, CO, TO, ENVO , and other ontologies as needed. These mappings allow semantic linkage for all qualifying datasets. Quantitative data must be mapped to at least two ontological terms: at least one that describes the data and at least one that describes the units of measurement. An example of how a grain yield term could be represented in JSON format is shown below:


                {
                "column_index": 22,
                "terms": [
                  {
                    "term_url": "http://purl.obolibrary.org/obo/TO_0000396"
                  }
                ], 
                "unit_url": "http://purl.obolibrary.org/obo/UO_0000283"
              },

where "column_index": 22 refers to the header for the column of data containing maize grain yield, "http://purl.obolibrary.org/obo/TO_0000396" is the uri  for the corresponding term in the trait ontology, and "http://purl.obolibrary.org/obo/UO_0000283" is the uri corresponding term in the Units Ontology. 

In addition to variable mapping, SC1 files contain metadata that describe who generated the dataset annotation, the source location of the raw data, the content of the file, and where data are located in the file. A sample can be seen in Appendix C.

For datasets generated by AgroFIMS, these annotations are already available as they are included as the data are collected. For other datasets, the data provider must generate these annotations. The COPO tool can be used to map the terms and generate SC1.

Sidecar file #2 (SC2) provides the steps necessary to convert data in the dataset to ICASA terms so that the AgMIP translators can be used to generate model-ready or analysis-ready files. A simple units conversion may be required if units differ between the raw data and the ICASA term. 

An example of a simple definition is shown in the following JSON snippet:

              {
                "icasa": "hwam",
                "column_index": 22,
                "unit": "kg/ha"
              },

where "hwam" is the ICASA term for harvested yield at maturity in kg/ha, "column_index": 22 indicates the location of the column of data,  and "unit": "kg/ha" indicates the units for the term in the raw data. The translator has logic to automatically convert units as necessary to ICASA-compliant units using the unit conversion library developed in Activity 2b.

In this simple case, the example for harvested grain weight is not much different than the SC1 snippet for this variable. But more complex transformations can be expressed. In the snippet below, planting density ("plpop") is computed from the spacing between rows ("plrs") and spacing of plants within a row ("plsp"). The formula, "10^4/(plrs * plsp)" , includes a conversion factor from cm-2 to m-2.    

    {
      "icasa": "plpop",
      "formula": "10^4/(plrs * plsp)",
      "unit": "m-2"
    },

The first step of creating SC2 will be to identify the standard terms for the minimum required quantitative data terms, as identified in Activity 3a. These minimum variables, including the ICASA variable name, are listed below:
1.	Location (latitude and longitude) – fl_lat and fl_long
2.	Crop species – crid
3.	Planting date – pdate
4.	Harvest date or maturity date – hdate, hdat, or mdat
5.	Harvested yield at harvest or at maturity – hwah  or hwam 

All five elements must be present for a dataset to be considered for further annotation for quantitative analyses. If these variables can be identified in the dataset, then the remaining variables will be identified to create a complete SC2.

A tool (VMapper) is currently being developed at UF to assist a user in mapping variables in Excel spreadsheets or CSV (comma-separated values) files to ICASA vocabulary; to specify the units of each variable; and to specify relational links between data in multiple sheets (if applicable). With this information, the app can then write the SC2 in JSON format. This tool was beyond the scope of this project but is under development as part of a grant from USDA and will be made available to CGIAR and GARDIAN for implementation as it becomes ready for testing. 

The VMapper tool under development is a relatively simple application with limited functionality. We envision that a more evolved AI-based version of this data annotation tool could act as a semi-intelligent, user-driven application that could suggest appropriate interpretations and units of each column header based on clues from the user, the data, and associated publications. The app would allow a user to identify and extract data embedded in non-columnar formats using more complex extraction functions. UF will continue to seek funding for development of this sort of AI-driven application.

Sidecar file #3 (SC3) contains data which will be available on GARDIAN for rapid, complex searches and for basic analytics. Because data accessible through GARDIAN are stored in different physical locations, with different formats, schemas, and vocabularies, searching through the actual datasets may not be possible within a reasonable amount of time. SC3 pre-exposes some interoperable data to enable fast querying of datasets which meet the minimum quantitative data criteria.

The variables or keys included in SC3 are (with ICASA variable names):
•	Experimental factors – factors 
•	Crop species – crid  4,  
•	Cultivar information – cul_text 4
•	Location – fl_lat and  fl_long 4,5
•	Elevation – flele
•	Planting date – pdate 5
•	Harvest date – hdate 5  
•	Anthesis date – adat 
•	Maturity date – mdat 5
•	Yield, dry matter – hwah 5
•	Aboveground biomass harvested as dry matter (kg/ha) – cwah 
•	Total N fertilizer applied (kg[N]/ha) – fen_tot
•	Total P fertilizer applied (kg[P]/ha) – fep_tot
•	Total K fertilizer applied (kg[K]/ha) – fek_tot
•	# of fertilizer applications – fert_#_tot
•	Total irrigation amount (mm) – ir_tot
•	# of irrigation applications – ir_#

SC3 contains three parts. The first part, SC3a, contains data extracted from the raw dataset which can be used for indexing, allowing rapid, advanced searches of annotated datasets. SC3a is a list of unique values of the variables of interest, presented as key-value pairs where the key is an ICASA variable name and the value is a vector including the range of unique values found in the full dataset. Additional metadata are included in SC3a which describe the number of treatments, the number of measurements of key variables, and the amount of weather and soil data included in the dataset. These data may be of interest to someone searching for datasets for quantitative analyses for specific purposes. Details are described in Appendix C.

The second part of SC3 contains a subset of the dataset, which are stored in tab-delimited format. Because this is a simple table with a standard set of columnar data, it can be used directly for analytics either alone or in combination with SC3 from other datasets.

The third section of SC3 contains statistics for the selected set of variables, including minimum, 25th percentile, mean, median, 75th percentile, maximum, and standard deviation. 

All three sections of SC3 can be generated using the information found in any AgMIP Crop Experiment Binary (ACEB) file. As part of the translation process, the SC3 data is extracted from each dataset automatically after translation. Because the files will be automatically generated from the data, the list of variables stored in SC3 could be expanded as needed. However, if the list of SC3 variables is expanded, older datasets would need to be reprocessed. 
The presence of SC3 indicates that this is a suitable dataset with quantitative data and it is ready for translation. SC3 also provides sufficient data to enable rapid advanced searches using metadata only. This is important because datasets are distributed and may not be quickly accessed and translated. Once a dataset is selected after a search of metadata, it can be converted to AgMIP data format using the information stored in SC2. Various model-ready formats and data analytics formats will be available to make these data useful on a variety of platforms. 

Issues encountered while interpreting the sample datasets
Many issues arose as the example datasets were mapped, which are an indication of the nearly infinite number of ways a dataset can be organized, annotated, and populated with data. Here is a sampling of the issues we found:
•	Column headers are located on arbitrary rows by dataset and even within datasets there may be little or no consistency between worksheets.
•	In at least one dataset, the column headers spanned multiple cells, or were nested in blocks, or were located on multiple rows.
•	Excel dates may not actually be stored as dates, but may be text, arbitrary mm-dd-yy or other orientations. Even within the same dataset and column of data, the date formats were found to vary. In this case, rules for data transformation may fail.
•	Time stamps are handled in different ways. For example, some dates refer to days after planting, others as true dates, others as day of year. This can be handled easily in the transformation rules, assuming there is consistency within the dataset.
•	Many datasets include data on measurements from individual plants in a plot, from replications of the same treatment, and for aggregated data. These are stored in various ways, including multiple tabs, multiple files, and a single file with all data. Our intent is to annotate all data and not try to force an aggregation which might be done differently for different applications.
•	Often data are entered with different formats or units within the same dataset. This might be because different people entered the data, or that data were entered at different times.
•	Not all datasets are complete. There may be missing data for some treatments or replicates.
•	Proprietary data formats (e.g., .dta file used by Stata) cannot be handled.
•	Compressed formats may present problems. Handling gzip and zip formats are trivial but handling rar and 7z formats are more challenging.
•	The ontologies lack terms for some of the variables and units encountered.
